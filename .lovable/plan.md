

# خطة تطوير المنصة الرياضية الشاملة

## الملخص

هذه الخطة تتضمن إصلاح مشكلة البيانات الحية، منح صلاحيات المسؤول، وإضافة ميزات المباريات التفاعلية.

---

## المرحلة 1: منح صلاحيات المسؤول

**المشكلة:** لا يوجد حساب مسجل بالبريد fartoo305@gmail.com في قاعدة البيانات حالياً.

**الحل:**
- يجب عليك أولاً التسجيل عبر صفحة `/auth` بالبريد fartoo305@gmail.com
- بعد التسجيل وتأكيد البريد، سأقوم بإدراج دور admin في جدول `user_roles` مباشرة

---

## المرحلة 2: إصلاح iSports API (مشكلة حرجة)

**المشكلة الحالية:** الاتصال يفشل بخطأ SSL:
```text
invalid peer certificate: NotValidForName
```

السبب: الكود يستخدم `https://api.isportsapi.com` بينما الوثائق الرسمية لـ iSports تحدد أن الرابط الصحيح هو `http://api.isportsapi.com` (بدون SSL). كما أن endpoint الحالي `/football/match/recent` غير صحيح.

**الحل:**
- تغيير رابط API في edge function من `https` الى `http`
- إضافة رابط احتياطي `http://api2.isportsapi.com`
- تصحيح endpoint النتائج الحية الى `/sport/football/livescores`
- إضافة endpoints كرة السلة `/sport/basketball/livescores`

**الملف المتأثر:** `supabase/functions/isports-proxy/index.ts`

---

## المرحلة 3: صفحة مباريات اليوم مع النتائج اللحظية

**ملفات جديدة:**
- `src/pages/LiveMatchesPage.tsx` - صفحة كاملة لعرض جميع مباريات اليوم
- `src/components/MatchCard.tsx` - بطاقة مباراة تفاعلية مع زر واتساب

**الميزات:**
- عرض جميع مباريات اليوم (كرة قدم + سلة) مع تحديث كل 60 ثانية
- عرض النتائج والدقيقة الحالية لكل مباراة
- زر "تابع الأهداف على واتساب" بجانب كل مباراة جارية
- تقسيم المباريات حسب الدوري

---

## المرحلة 4: تحسين قسم النتائج المباشرة في الصفحة الرئيسية

- إضافة رابط "عرض جميع المباريات" أسفل قسم النتائج يوجه لصفحة المباريات
- إضافة زر واتساب صغير بجانب كل مباراة جارية في الشريط الجانبي

---

## المرحلة 5: الحفاظ على مساحات الإعلانات

- التأكد من بقاء مساحات AdSense في أماكنها (الهيدر، الشريط الجانبي)
- إضافة مساحة إعلانية في صفحة المباريات الجديدة

---

## المرحلة 6: تحديث التوجيه (Routing)

- إضافة مسار `/matches` لصفحة المباريات في `App.tsx`
- إضافة رابط "المباريات" في القائمة الرئيسية

---

## ملاحظة مهمة بخصوص الإحصائيات التفصيلية والبث النصي

iSports API توفر بيانات النتائج الحية الأساسية (فرق، نتائج، دقائق). الإحصائيات التفصيلية (استحواذ، ركنيات، بطاقات) والتشكيلات والبث النصي دقيقة بدقيقة تتطلب endpoints إضافية من خطة "Live Data" المدفوعة. سأبني الهيكل الجاهز لعرضها، وعند توفر البيانات ستظهر تلقائياً.

---

## التفاصيل التقنية

### تعديل Edge Function (isports-proxy)
```text
- تغيير baseUrl من https://api.isportsapi.com الى http://api.isportsapi.com
- إضافة fallback الى http://api2.isportsapi.com عند فشل الاتصال
- تصحيح endpoint من /football/match/recent الى /football/livescores
```

### الملفات المتأثرة
1. `supabase/functions/isports-proxy/index.ts` - إصلاح رابط API
2. `src/hooks/useLiveScores.ts` - تصحيح endpoint المرسل
3. `src/pages/LiveMatchesPage.tsx` - صفحة جديدة
4. `src/components/MatchCard.tsx` - مكون جديد
5. `src/components/LiveScores.tsx` - إضافة رابط للصفحة الكاملة وزر واتساب
6. `src/App.tsx` - إضافة مسار /matches
7. `src/components/Header.tsx` - إضافة رابط المباريات

### الخطوة الأولى المطلوبة منك
اذهب الى صفحة `/auth` وسجل حساباً جديداً بالبريد **fartoo305@gmail.com** ثم أخبرني حتى أمنحك صلاحيات المسؤول وأنفذ باقي الخطة.

